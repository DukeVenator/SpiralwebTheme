"use strict";var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var ActionsClass=function(){function e(t,n){_classCallCheck(this,e),this.element=t,this.menu=n}return _createClass(e,[{key:"destroy",value:function(){this.element=void 0}},{key:"folder",value:function(e){var t=void 0;if(e)t=e;else{var n=$(this.element).find('td[data-identifier="name"]'),o=decodeURIComponent(n.data("name")),a=decodeURIComponent(n.data("path"));t="file"===$(this.element).data("type")?a:""+a+o+"/"}swal({type:"input",title:"Create Folder",text:"Please enter the path and folder name below.",showCancelButton:!0,showConfirmButton:!0,closeOnConfirm:!1,showLoaderOnConfirm:!0,inputValue:t},function(e){if(!1===e)return!1;$.ajax({type:"POST",headers:{"X-Access-Token":Pterodactyl.server.daemonSecret,"X-Access-Server":Pterodactyl.server.uuid},contentType:"application/json; charset=utf-8",url:Pterodactyl.node.scheme+"://"+Pterodactyl.node.fqdn+":"+Pterodactyl.node.daemonListen+"/v1/server/file/folder",timeout:1e4,data:JSON.stringify({path:e})}).done(function(e){swal.close(),Files.list()}).fail(function(e){console.error(e);var t="An error occurred while trying to process this request.";void 0!==e.responseJSON&&void 0!==e.responseJSON.error&&(t=e.responseJSON.error),swal({type:"error",title:"",text:t})})})}},{key:"move",value:function(){var e=$(this.element).find('td[data-identifier="name"]'),t=decodeURIComponent(e.attr("data-name")),n=decodeURIComponent(e.data("path"));swal({type:"input",title:"Move File",text:"Please enter the new path for the file below.",showCancelButton:!0,showConfirmButton:!0,closeOnConfirm:!1,showLoaderOnConfirm:!0,inputValue:""+n+t},function(o){if(!1===o)return!1;$.ajax({type:"POST",headers:{"X-Access-Token":Pterodactyl.server.daemonSecret,"X-Access-Server":Pterodactyl.server.uuid},contentType:"application/json; charset=utf-8",url:Pterodactyl.node.scheme+"://"+Pterodactyl.node.fqdn+":"+Pterodactyl.node.daemonListen+"/v1/server/file/move",timeout:1e4,data:JSON.stringify({from:""+n+t,to:""+o})}).done(function(t){e.parent().addClass("warning").delay(200).fadeOut(),swal.close()}).fail(function(e){console.error(e);var t="An error occurred while trying to process this request.";void 0!==e.responseJSON&&void 0!==e.responseJSON.error&&(t=e.responseJSON.error),swal({type:"error",title:"",text:t})})})}},{key:"rename",value:function(){var e=$(this.element).find('td[data-identifier="name"]'),t=e.find("a"),n=decodeURIComponent(e.attr("data-name")),o='\n            <input class="form-control input-sm" type="text" value="'+n+'" />\n            <span class="input-loader"><i class="fa fa-refresh fa-spin fa-fw"></i></span>\n        ';e.html(o);var a=e.find("input"),i=e.find(".input-loader");a.focus(),a.on("blur keydown",function(o){if("keydown"===o.type&&27===o.which||"blur"===o.type||"keydown"===o.type&&13===o.which&&n===a.val())return _.isEmpty(t)?e.html(n):e.html(t),a.remove(),void ContextMenu.unbind().run();if("keydown"!==o.type||13===o.which){i.show();var r=decodeURIComponent(e.data("path"));$.ajax({type:"POST",headers:{"X-Access-Token":Pterodactyl.server.daemonSecret,"X-Access-Server":Pterodactyl.server.uuid},contentType:"application/json; charset=utf-8",url:Pterodactyl.node.scheme+"://"+Pterodactyl.node.fqdn+":"+Pterodactyl.node.daemonListen+"/v1/server/file/rename",timeout:1e4,data:JSON.stringify({from:""+r+n,to:""+r+a.val()})}).done(function(n){if(e.attr("data-name",a.val()),_.isEmpty(t))e.html(a.val());else{var o=t.attr("href");"folder"!==e.parent().data("type")&&(o=o.substr(0,o.lastIndexOf("/"))+"/"+a.val()),t.attr("href",o),e.html(t.html(a.val()))}a.remove()}).fail(function(t){console.error(t);var n="An error occurred while trying to process this request.";void 0!==t.responseJSON&&void 0!==t.responseJSON.error&&(n=t.responseJSON.error),e.addClass("has-error").delay(2e3).queue(function(){e.removeClass("has-error").dequeue()}),a.popover({animation:!0,placement:"top",content:n,title:"Save Error"}).popover("show")}).always(function(){i.remove(),ContextMenu.unbind().run()})}})}},{key:"copy",value:function(){var e=$(this.element).find('td[data-identifier="name"]'),t=decodeURIComponent(e.attr("data-name")),n=decodeURIComponent(e.data("path"));swal({type:"input",title:"Copy File",text:"Please enter the new path for the copied file below.",showCancelButton:!0,showConfirmButton:!0,closeOnConfirm:!1,showLoaderOnConfirm:!0,inputValue:""+n+t},function(e){if(!1===e)return!1;$.ajax({type:"POST",headers:{"X-Access-Token":Pterodactyl.server.daemonSecret,"X-Access-Server":Pterodactyl.server.uuid},contentType:"application/json; charset=utf-8",url:Pterodactyl.node.scheme+"://"+Pterodactyl.node.fqdn+":"+Pterodactyl.node.daemonListen+"/v1/server/file/copy",timeout:1e4,data:JSON.stringify({from:""+n+t,to:""+e})}).done(function(e){swal({type:"success",title:"",text:"File successfully copied."}),Files.list()}).fail(function(e){console.error(e);var t="An error occurred while trying to process this request.";void 0!==e.responseJSON&&void 0!==e.responseJSON.error&&(t=e.responseJSON.error),swal({type:"error",title:"",text:t})})})}},{key:"download",value:function(){var e=$(this.element).find('td[data-identifier="name"]'),t=decodeURIComponent(e.attr("data-name")),n=decodeURIComponent(e.data("path"));window.location="/server/"+Pterodactyl.server.uuidShort+"/files/download/"+n+t}},{key:"delete",value:function(){var e=$(this.element).find('td[data-identifier="name"]'),t=decodeURIComponent(e.data("path")),n=decodeURIComponent(e.data("name"));swal({type:"warning",title:"",text:"Are you sure you want to delete <code>"+n+"</code>?",html:!0,showCancelButton:!0,showConfirmButton:!0,closeOnConfirm:!1,showLoaderOnConfirm:!0},function(){$.ajax({type:"POST",headers:{"X-Access-Token":Pterodactyl.server.daemonSecret,"X-Access-Server":Pterodactyl.server.uuid},contentType:"application/json; charset=utf-8",url:Pterodactyl.node.scheme+"://"+Pterodactyl.node.fqdn+":"+Pterodactyl.node.daemonListen+"/v1/server/file/delete",timeout:1e4,data:JSON.stringify({items:[""+t+n]})}).done(function(t){e.parent().addClass("warning").delay(200).fadeOut(),swal({type:"success",title:"File Deleted"})}).fail(function(e){console.error(e),swal({type:"error",title:"Whoops!",html:!0,text:"An error occurred while attempting to delete this file. Please try again."})})})}},{key:"toggleMassActions",value:function(){$('#file_listing input[type="checkbox"]:checked').length?$("#mass_actions").removeClass("disabled"):$("#mass_actions").addClass("disabled")}},{key:"toggleHighlight",value:function(e){var t=$(e.currentTarget),n=$(e.currentTarget).find("input");$(n).is(":checked")?($(n).prop("checked",!1),t.removeClass("warning").delay(200)):($(n).prop("checked",!0),t.addClass("warning").delay(200))}},{key:"highlightAll",value:function(e){var t=$(e.currentTarget).find("input");$(t).is(":checked")?($("#file_listing input[type=checkbox]").prop("checked",!1),$('#file_listing input[data-action="addSelection"]').each(function(){$(this).closest("tr").removeClass("warning").delay(200)})):($("#file_listing input[type=checkbox]").prop("checked",!0),$('#file_listing input[data-action="addSelection"]').each(function(){$(this).closest("tr").addClass("warning").delay(200)}))}},{key:"deleteSelected",value:function(){var e=[],t=[],n=void 0,o=void 0,a=void 0;if($('#file_listing input[data-action="addSelection"]:checked').each(function(){n=$(this).closest("tr"),o=$(n).find('td[data-identifier="name"]'),a=decodeURIComponent(o.data("path"))+decodeURIComponent(o.data("name")),e.push(a),t.push(n)}),0!=e.length){var i="",r=0;$.each(e,function(e,t){return i+="<code>"+t+"</code>, ",++r<5}),i=i.slice(0,-2),e.length>5&&(i+=", and "+(e.length-5)+" other(s)"),swal({type:"warning",title:"",text:"Are you sure you want to delete the following files: "+i+"?",html:!0,showCancelButton:!0,showConfirmButton:!0,closeOnConfirm:!1,showLoaderOnConfirm:!0},function(){$.ajax({type:"POST",headers:{"X-Access-Token":Pterodactyl.server.daemonSecret,"X-Access-Server":Pterodactyl.server.uuid},contentType:"application/json; charset=utf-8",url:Pterodactyl.node.scheme+"://"+Pterodactyl.node.fqdn+":"+Pterodactyl.node.daemonListen+"/v1/server/file/delete",timeout:1e4,data:JSON.stringify({items:e})}).done(function(e){$("#file_listing input:checked").each(function(){$(this).prop("checked",!1)}),$.each(t,function(){$(this).addClass("warning").delay(200).fadeOut()}),swal({type:"success",title:"Files Deleted"})}).fail(function(e){console.error(e),swal({type:"error",title:"Whoops!",html:!0,text:"An error occurred while attempting to delete these files. Please try again."})})})}else swal({type:"warning",title:"",text:"Please select files/folders to delete."})}},{key:"decompress",value:function(){var e=$(this.element).find('td[data-identifier="name"]'),t=decodeURIComponent(e.data("path")),n=decodeURIComponent(e.data("name"));swal({title:'<i class="fa fa-refresh fa-spin"></i> Decompressing...',text:"This might take a few seconds to complete.",html:!0,allowOutsideClick:!1,allowEscapeKey:!1,showConfirmButton:!1}),$.ajax({type:"POST",url:Pterodactyl.node.scheme+"://"+Pterodactyl.node.fqdn+":"+Pterodactyl.node.daemonListen+"/v1/server/file/decompress",headers:{"X-Access-Token":Pterodactyl.server.daemonSecret,"X-Access-Server":Pterodactyl.server.uuid},contentType:"application/json; charset=utf-8",data:JSON.stringify({files:""+t+n})}).done(function(e){swal.close(),Files.list(t)}).fail(function(e){console.error(e);var t="An error occurred while trying to process this request.";void 0!==e.responseJSON&&void 0!==e.responseJSON.error&&(t=e.responseJSON.error),swal({type:"error",title:"Whoops!",html:!0,text:t})})}},{key:"compress",value:function(){var e=$(this.element).find('td[data-identifier="name"]'),t=decodeURIComponent(e.data("path")),n=decodeURIComponent(e.data("name"));$.ajax({type:"POST",url:Pterodactyl.node.scheme+"://"+Pterodactyl.node.fqdn+":"+Pterodactyl.node.daemonListen+"/v1/server/file/compress",headers:{"X-Access-Token":Pterodactyl.server.daemonSecret,"X-Access-Server":Pterodactyl.server.uuid},contentType:"application/json; charset=utf-8",data:JSON.stringify({files:""+t+n,to:t.toString()})}).done(function(e){Files.list(t,function(t){if(!t){var n=$("#file_listing").find('[data-name="'+e.saved_as+'"]').parent();n.addClass("success pulsate").delay(3e3).queue(function(){n.removeClass("success pulsate").dequeue()})}})}).fail(function(e){console.error(e);var t="An error occurred while trying to process this request.";void 0!==e.responseJSON&&void 0!==e.responseJSON.error&&(t=e.responseJSON.error),swal({type:"error",title:"Whoops!",html:!0,text:t})})}}]),e}();_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var ContextMenuClass=function(){function e(){_classCallCheck(this,e),this.activeLine=null}return _createClass(e,[{key:"run",value:function(){this.directoryClick(),this.rightClick()}},{key:"makeMenu",value:function(e){$(document).find("#fileOptionMenu").remove(),_.isNull(this.activeLine)||this.activeLine.removeClass("active");var t=$("#file_listing").data("current-dir");if("folder"===e.data("type")){var n=e.find('td[data-identifier="name"]'),o=decodeURIComponent(n.attr("data-name"));t=""+decodeURIComponent(n.data("path"))+o}var a='<ul id="fileOptionMenu" class="dropdown-menu" role="menu" style="display:none" >';return Pterodactyl.permissions.moveFiles&&(a+='<li data-action="rename"><a class="text-muted" tabindex="-1" href="#"><i class="fa fa-fw fa-compress"></i> Rename</a></li>                           <li data-action="move"><a class="text-muted" tabindex="-1" href="#"><i class="fa fa-fw fa-arrow-right"></i> Move</a></li>'),Pterodactyl.permissions.copyFiles&&(a+='<li data-action="copy"><a class="text-muted" tabindex="-1" href="#"><i class="fa fa-fw fa-clone"></i> Copy</a></li>'),Pterodactyl.permissions.compressFiles&&(a+='<li data-action="compress" class="hidden"><a class="text-muted" tabindex="-1" href="#"><i class="fa fa-fw fa-file-archive"></i> Compress</a></li>'),Pterodactyl.permissions.decompressFiles&&(a+='<li data-action="decompress" class="hidden"><a class="text-muted" tabindex="-1" href="#"><i class="fa fa-fw fa-expand"></i> Decompress</a></li>'),Pterodactyl.permissions.createFiles&&(a+='<li class="divider"></li>                           <li data-action="file"><a href="/server/'+Pterodactyl.server.uuidShort+"/files/add/?dir="+t+'" class="text-muted"><i class="fa fa-fw fa-plus"></i> New File</a></li>                           <li data-action="folder"><a class="text-muted" tabindex="-1" href="#"><i class="fa fa-fw fa-folder"></i> New Folder</a></li>'),(Pterodactyl.permissions.downloadFiles||Pterodactyl.permissions.deleteFiles)&&(a+='<li class="divider"></li>'),Pterodactyl.permissions.downloadFiles&&(a+='<li data-action="download" class="hidden"><a class="text-muted" tabindex="-1" href="#"><i class="fa fa-fw fa-download"></i> Download</a></li>'),Pterodactyl.permissions.deleteFiles&&(a+='<li data-action="delete" class="bg-danger"><a tabindex="-1" href="#"><i class="fa fa-fw fa-trash"></i> Delete</a></li>'),a+="</ul>"}},{key:"rightClick",value:function(){var e=this;$('[data-action="toggleMenu"]').on("mousedown",function(t){t.preventDefault(),$(document).find("#fileOptionMenu").is(":visible")?$("body").trigger("click"):e.showMenu(t)}),$("#file_listing > tbody td").on("contextmenu",function(t){e.showMenu(t)})}},{key:"showMenu",value:function(e){var t=this,n=$(e.target).closest("tr"),o=$(this.makeMenu(n));if("disabled"!==n.data("type")){e.preventDefault(),$(o).appendTo("body"),$(o).data("invokedOn",$(e.target)).show().css({position:"absolute",left:e.pageX-150,top:e.pageY}),this.activeLine=n,this.activeLine.addClass("active");var a=new ActionsClass(n,o);Pterodactyl.permissions.moveFiles&&($(o).find('li[data-action="move"]').unbind().on("click",function(e){e.preventDefault(),a.move()}),$(o).find('li[data-action="rename"]').unbind().on("click",function(e){e.preventDefault(),a.rename()})),Pterodactyl.permissions.copyFiles&&$(o).find('li[data-action="copy"]').unbind().on("click",function(e){e.preventDefault(),a.copy()}),Pterodactyl.permissions.compressFiles&&("folder"===n.data("type")&&$(o).find('li[data-action="compress"]').removeClass("hidden"),$(o).find('li[data-action="compress"]').unbind().on("click",function(e){e.preventDefault(),a.compress()})),Pterodactyl.permissions.decompressFiles&&(_.without(["application/zip","application/gzip","application/x-gzip"],n.data("mime")).length<3&&$(o).find('li[data-action="decompress"]').removeClass("hidden"),$(o).find('li[data-action="decompress"]').unbind().on("click",function(e){e.preventDefault(),a.decompress()})),Pterodactyl.permissions.createFiles&&$(o).find('li[data-action="folder"]').unbind().on("click",function(e){e.preventDefault(),a.folder()}),Pterodactyl.permissions.downloadFiles&&("file"===n.data("type")&&$(o).find('li[data-action="download"]').removeClass("hidden"),$(o).find('li[data-action="download"]').unbind().on("click",function(e){e.preventDefault(),a.download()})),Pterodactyl.permissions.deleteFiles&&$(o).find('li[data-action="delete"]').unbind().on("click",function(e){e.preventDefault(),a.delete()}),$(window).unbind().on("click",function(e){$(e.target).is(".disable-menu-hide")?e.preventDefault():($(o).unbind().remove(),_.isNull(t.activeLine)||t.activeLine.removeClass("active"))})}}},{key:"directoryClick",value:function(){$('a[data-action="directory-view"]').on("click",function(e){e.preventDefault();var t=$(this).parent().data("path")||"",n=$(this).parent().data("name")||"";window.location.hash=encodeURIComponent(t+n),Files.list()})}}]),e}();window.ContextMenu=new ContextMenuClass;var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var FileManager=function(){function e(){_classCallCheck(this,e),this.list(this.decodeHash())}return _createClass(e,[{key:"list",value:function(e,t){var n=this;_.isUndefined(e)&&(e=this.decodeHash()),this.loader(!0),$.ajax({type:"POST",url:Pterodactyl.meta.directoryList,headers:{"X-CSRF-Token":Pterodactyl.meta.csrftoken},data:{directory:e}}).done(function(e){n.loader(!1),$("#load_files").slideUp(10).html(e).slideDown(10,function(){if(ContextMenu.run(),n.reloadFilesButton(),n.addFolderButton(),n.selectItem(),n.selectAll(),n.selectiveDeletion(),n.selectRow(),_.isFunction(t))return t()}),$("#internal_alert").slideUp(),"object"===("undefined"==typeof Siofu?"undefined":_typeof(Siofu))&&Siofu.listenOnInput(document.getElementById("files_touch_target"))}).fail(function(o){return n.loader(!1),_.isFunction(t)?t(new Error("Failed to load file listing.")):""!==e&&"/"!==e&&404===o.status?n.list("",t):(swal({type:"error",title:"File Error",text:o.responseJSON.errors[0].detail||"An error occurred while attempting to process this request. Please try again."}),void console.error(o))})}},{key:"loader",value:function(e){e?$(".file-overlay").fadeIn(100):$(".file-overlay").fadeOut(100)}},{key:"reloadFilesButton",value:function(){var e=this;$('i[data-action="reload-files"]').unbind().on("click",function(){$('i[data-action="reload-files"]').addClass("fa-spin"),e.list()})}},{key:"selectItem",value:function(){$('[data-action="addSelection"]').on("click",function(e){e.preventDefault()})}},{key:"selectAll",value:function(){$('[data-action="selectAll"]').on("click",function(e){e.preventDefault()})}},{key:"selectiveDeletion",value:function(){$('[data-action="selective-deletion"]').on("mousedown",function(e){(new ActionsClass).deleteSelected()})}},{key:"addFolderButton",value:function(){$('[data-action="add-folder"]').unbind().on("click",function(){(new ActionsClass).folder($("#file_listing").data("current-dir")||"/")})}},{key:"selectRow",value:function(){$("#file_listing tr").on("mousedown",function(e){1===e.which&&($(e.target).is("th")||$(e.target).is('input[data-action="selectAll"]')?(new ActionsClass).highlightAll(e):($(e.target).is("td")||$(e.target).is('input[data-action="addSelection"]'))&&(new ActionsClass).toggleHighlight(e),(new ActionsClass).toggleMassActions())})}},{key:"decodeHash",value:function(){return decodeURIComponent(window.location.hash.substring(1))}}]),e}();window.Files=new FileManager;